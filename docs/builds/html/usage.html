

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usage &mdash; kanapy 6.5.3.post1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=53ab5b41"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modeling" href="method.html" />
    <link rel="prev" title="Applications" href="applications.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            kanapy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Applications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#kanapy-s-cli">Kanapy’s CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kanapy-s-api-incomplete">Kanapy’s API (incomplete)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#microstructure-descriptors">Microstructure descriptors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorials">Tutorials</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#notebooks">Notebooks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#outdated-cli-contents">Outdated CLI contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#workflows-for-sphere-packing">Workflows for sphere packing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workflows-for-ellipsoid-packing">Workflows for ellipsoid packing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#texture-examples">Texture examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#workflow-for-odf-reconstruction">Workflow for ODF reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workflow-for-odf-reconstruction-with-orientation-assignment">Workflow for ODF reconstruction with orientation assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualize-the-packing-simulation">Visualize the packing simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="method.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="kanapy.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">kanapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h1>
<section id="kanapy-s-cli">
<h2>Kanapy’s CLI<a class="headerlink" href="#kanapy-s-cli" title="Link to this heading"></a></h2>
<p>Kanapy provides some basic command line instructions to manage the installation.
The</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kanapy</span> <span class="pre">--help</span></code> command
details this as shown:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that you are within the virtual environment created during the kanapy installation, as
this environment contains the kanapy instalation and its required dependencies.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>knpy
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>--help
<span class="go">        Usage: kanapy [OPTIONS] COMMAND [ARGS]...</span>

<span class="go">        Options:</span>
<span class="go">          --help  Show this message and exit.</span>

<span class="go">        Commands:</span>
<span class="go">          copyExamples  Creates local copy of Kanapy&#39;s example directory.</span>
<span class="go">          genDocs       Generates a HTML-based reference documentation.</span>
<span class="go">          gui           Start Kanapy&#39;s GUI</span>
<span class="go">          runTests      Runs unittests built-in to Kanapy.</span>
<span class="go">          setupTexture  Stores the user provided MATLAB &amp; MTEX paths for texture.</span>
</pre></div>
</div>
</section>
<section id="kanapy-s-api-incomplete">
<h2>Kanapy’s API (incomplete)<a class="headerlink" href="#kanapy-s-api-incomplete" title="Link to this heading"></a></h2>
<p>Under construction …</p>
<p>The central element of Kanapy are statistical microstructure descriptors, which are used
to generate the microstructure geometry and its texture in the different Kanapy modules.
For multiphase microstructures, each phase has its own statistical descriptors and the
respective dictionaries and combined to a list.</p>
<section id="microstructure-descriptors">
<h3>Microstructure descriptors<a class="headerlink" href="#microstructure-descriptors" title="Link to this heading"></a></h3>
<p>An exemplary structure of the descriptor dictionary is shown below:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;Grain type&quot;</span>:
<span class="w">    </span><span class="s2">&quot;Elongated&quot;</span>,
<span class="w">  </span><span class="s2">&quot;Equivalent diameter&quot;</span>:
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;sig&quot;</span>:<span class="w"> </span><span class="m">0</span>.39,
<span class="w">      </span><span class="s2">&quot;scale&quot;</span>:<span class="w"> </span><span class="m">2</span>.418,
<span class="w">      </span><span class="s2">&quot;loc&quot;</span>:<span class="w"> </span><span class="m">0</span>.0,
<span class="w">      </span><span class="s2">&quot;cutoff_min&quot;</span>:<span class="w"> </span><span class="m">8</span>.0,
<span class="w">      </span><span class="s2">&quot;cutoff_max&quot;</span>:<span class="w"> </span><span class="m">25</span>.0
<span class="w">    </span><span class="o">}</span>,
<span class="w">  </span><span class="s2">&quot;Aspect ratio&quot;</span>:
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;sig&quot;</span>:<span class="w"> </span><span class="m">0</span>.3,
<span class="w">      </span><span class="s2">&quot;scale&quot;</span>:<span class="w"> </span><span class="m">0</span>.918,
<span class="w">      </span><span class="s2">&quot;loc&quot;</span>:<span class="w"> </span><span class="m">0</span>.0
<span class="w">      </span><span class="s2">&quot;cutoff_min&quot;</span>:<span class="w"> </span><span class="m">1</span>.0,
<span class="w">      </span><span class="s2">&quot;cutoff_max&quot;</span>:<span class="w"> </span><span class="m">4</span>.0
<span class="w">    </span><span class="o">}</span>,
<span class="w">  </span><span class="s2">&quot;Tilt angle&quot;</span>:
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;kappa&quot;</span>:<span class="w"> </span><span class="m">15</span>.8774,
<span class="w">      </span><span class="s2">&quot;loc&quot;</span>:<span class="w"> </span><span class="m">87</span>.4178,
<span class="w">      </span><span class="s2">&quot;cutoff_min&quot;</span>:<span class="w"> </span><span class="m">75</span>.0,
<span class="w">      </span><span class="s2">&quot;cutoff_max&quot;</span>:<span class="w"> </span><span class="m">105</span>.0
<span class="w">    </span><span class="o">}</span>,
<span class="w">  </span><span class="s2">&quot;RVE&quot;</span>:
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;sideX&quot;</span>:<span class="w"> </span><span class="m">85</span>.9,
<span class="w">      </span><span class="s2">&quot;sideY&quot;</span>:<span class="w"> </span><span class="m">112</span>.33076,
<span class="w">      </span><span class="s2">&quot;sideZ&quot;</span>:<span class="w"> </span><span class="m">85</span>.9,
<span class="w">      </span><span class="s2">&quot;Nx&quot;</span>:<span class="w"> </span><span class="m">65</span>,
<span class="w">      </span><span class="s2">&quot;Ny&quot;</span>:<span class="w"> </span><span class="m">85</span>,
<span class="w">      </span><span class="s2">&quot;Nz&quot;</span>:<span class="w"> </span><span class="m">65</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">  </span><span class="s2">&quot;Simulation&quot;</span>:
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;periodicity&quot;</span>:<span class="w"> </span><span class="s2">&quot;True&quot;</span>,
<span class="w">      </span><span class="s2">&quot;output_units&quot;</span>:<span class="w"> </span><span class="s2">&quot;mm&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">  </span><span class="s2">&quot;Phase&quot;</span>:
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;Name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Simulanium&quot;</span>,
<span class="w">      </span><span class="s2">&quot;Number&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">      </span><span class="s2">&quot;Volume fraction&quot;</span>:<span class="w"> </span><span class="m">1</span>.0
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Sample dictionaries are provided in the examples shown below. Note that descriptors can
be stored and read from JSON files. In the following the essentail keywords:
<code class="docutils literal notranslate"><span class="pre">Grain</span> <span class="pre">type,</span> <span class="pre">Equivalent</span> <span class="pre">diameter,</span> <span class="pre">Aspect</span> <span class="pre">ratio,</span> <span class="pre">Tilt</span> <span class="pre">angle,</span> <span class="pre">RVE,</span> <span class="pre">Simulation,</span> <span class="pre">Phase</span></code> are described</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Grain</span> <span class="pre">type</span></code> (mandatory): Either “Elongated” or “Equiaxed”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Equivalent</span> <span class="pre">diameter</span></code> (mandatory): takes in four arguments to generate a
log-normal distribution for the particle’s equivalent diameter; they are the
<a class="reference external" href="https://en.wikipedia.org/wiki/Normal_distribution">Normal distribution’s</a> standard deviation and mean, and the minimum
and maximum cut-off values for the diameter. The values should correspond to <span class="math notranslate nohighlight">\(\mu m\)</span> scale.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Aspect</span> <span class="pre">ratio</span></code> takes the mean and the standard deviation value value as input. If the resultant
microstructure contains equiaxed grains then this field is not necessary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tilt</span> <span class="pre">angle</span></code> keyword represents the tilt angle of particles with
respect to the positive x-axis. Hence, to generate a distribution, it takes in
two arguments: the normal distribution’s mean and the standard deviation. If the resultant
microstructure contains equiaxed grains then this field is also not necessary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RVE</span></code> takes two types of input: the side lengths of the final RVE
required and the number of voxels per RVE side length.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Simulation</span></code>  takes in two inputs: A boolean value for periodicity (True/False)
and the required unit scale (‘mm’ or ‘um’ = <span class="math notranslate nohighlight">\(\mu m\)</span>) for the output
ABAQUS .inp file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Phase</span></code> (optional) Information about phase name, number and volume fraction.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The user may choose not to use the built-in voxelization (meshing) routine
for meshing the final RVE. Nevertheless, a value for the number of voxels
per side has to be provided.</p></li>
<li><p>A good estimation for <cite>Nx, Ny &amp; Nz</cite> value can be made by keeping the
following point in mind: The smallest dimension of the smallest ellipsoid/sphere
should contain at least 3 voxels.</p></li>
<li><p>The size of voxels should be the same along X, Y &amp; Z directions
(voxel_sizeX = voxel_sizeY = voxel_sizeZ).
It is determined using: voxel size = RVE side length/Voxel per side.</p></li>
<li><p>Particles grow during the simulation. At the start of the simulation, all particles
are initialized with null volume. At each time step, they grow in size by the
value: diameter/1000. Since the maximum packing density of ellipsoides is
about 65%, the full space filling structure is achieved during voxelization.</p></li>
<li><p>The input unit scale should be in <span class="math notranslate nohighlight">\(\mu m\)</span> and the user can choose between
‘mm’ or ‘um’ (= <span class="math notranslate nohighlight">\(\mu m\)</span>) as the unit scale in which output to the
ABAQUS .inp file will be written.</p></li>
</ol>
</div>
</section>
<section id="tutorials">
<h3>Tutorials<a class="headerlink" href="#tutorials" title="Link to this heading"></a></h3>
<p>Several examples in form of Python scripts and Jupyter notebooks come bundled along with
the kanapy package. Each example describes a particular workflow and demonstrates the use
of the geometry module and the texture module. Note, that the latter requires a complete
Kanapy installation including MTEX, that can be setup with the ‘kanapy setupTexture’
command.</p>
<section id="notebooks">
<h4>Notebooks<a class="headerlink" href="#notebooks" title="Link to this heading"></a></h4>
<ul>
<li><div class="line-block">
<div class="line"><a class="reference external" href="_static/generate_rve.html">generate_rve.ipynb</a></div>
<div class="line">The basic steps of using Kanapy to generate synthetic
representative volume elements (RVE) are demonstrated. The RVE can
be exported in standard FEA formats.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><a class="reference external" href="_static/ebsd2rve.html">ebsd2rve.ipynb</a></div>
<div class="line">An EBSD map aof a austenitic steel produced by additive
manufacturing is analyzed with respect to statistical
microstructure descriptors. The descriptors are the basis to build
an RVE.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><a class="reference external" href="_static/dispersed_phase.html">dispersed_phase.ipynb</a></div>
<div class="line">A polycrystal with a second phase dispersed along the grain
boundaries is generated.</div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="outdated-cli-contents">
<h2>Outdated CLI contents<a class="headerlink" href="#outdated-cli-contents" title="Link to this heading"></a></h2>
<p>The following sections refer mainly to CLI commands from previous Kanapy versions.
To be updated …</p>
<p>Hence the examples are sub-categorized here under
two sub-sections: Geometry examples and Texture examples. A detailed description of these examples is presented here.
The two examples <code class="docutils literal notranslate"><span class="pre">sphere_packing</span></code> and <code class="docutils literal notranslate"><span class="pre">ellipsoid_packing</span></code> depict the different workflows
that have to be setup for generating synthetic microstructures with equiaxed and elongated
grains, respectively. And the two examples <code class="docutils literal notranslate"><span class="pre">ODF_reconstruction</span></code> and <code class="docutils literal notranslate"><span class="pre">ODF_reconstruction_with_orientation_assignment</span></code>
depict the workflows for reconstructing ODF from EBSD data and assigning orientations to RVE grains, respectively.
For a detailed understanding of the general framework of the packing simulations or the ODF reconstruction, please
refer to: <a class="reference internal" href="method.html#modeling"><span class="std std-ref">Modeling</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>New examples must be created in a separate directory. It allows the kanapy modules
an easy access to the json, dump and other files created during the simulation.</p>
</div>
<section id="workflows-for-sphere-packing">
<h3>Workflows for sphere packing<a class="headerlink" href="#workflows-for-sphere-packing" title="Link to this heading"></a></h3>
<p>This example demonstrates the workflow for generating synthetic microstructures with
equiaxed grains. The principle involved in generating such microstructures are described
in the sub-section <a class="reference internal" href="applications.html#microstructure-with-equiaxed-grains"><span class="std std-ref">Microstructure with equiaxed grains</span></a>. With respect to the final RVE mesh,
the user has the flexibility to choose between the in-built voxelization routine and external meshing softwares.</p>
<p>If external meshing is required, the positions and weights of the particles (spheres) after packing
can be written out to be post-processed. The positions and weights can be read by the Voronoi tessellation
and meshing software <a class="reference external" href="http://neper.sourceforge.net/">Neper</a> for generating tessellations and FEM mesh. For more details refer to Neper’s
<a class="reference external" href="https://ovito.org/manual/">documentation</a>.</p>
<p>If the in-built voxelization routine is prefered, then kanapy will generate
hexahedral element (C3D8) mesh that can be read by the commercial FEM software <a class="reference external" href="https://www.3ds.com/products-services/simulia/products/abaqus/">Abaqus</a>. The Abaqus .inp
file will be written out in either <span class="math notranslate nohighlight">\(mm\)</span> or <span class="math notranslate nohighlight">\(\mu m\)</span> scale.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">knpy</span><span class="o">.</span><span class="n">Microstructure</span><span class="p">(</span><span class="n">descriptor</span><span class="o">=</span><span class="n">ms_elong</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">matname</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">texture</span> <span class="o">+</span> <span class="s1">&#39;_texture&#39;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">init_RVE</span><span class="p">()</span>  <span class="c1"># initialize RVE including particle distribution and structured mesh</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">plot_stats_init</span><span class="p">()</span>  <span class="c1"># plot initial statistics of equivalent grain diameter and aspect ratio</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>  <span class="c1"># perform particle simulation to distribute grain nuclei in RVE volume</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">plot_ellipsoids</span><span class="p">()</span>  <span class="c1"># plot final configuration of particles</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">voxelize</span><span class="p">()</span>  <span class="c1"># assign voxels to grains according to particle configuration</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">plot_voxels</span><span class="p">(</span><span class="n">sliced</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># plot voxels colored according to grain number</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">generate_grains</span><span class="p">()</span>  <span class="c1"># generate a polyhedral hull around each voxelized grain</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">plot_grains</span><span class="p">()</span>  <span class="c1"># plot polyhedral grains</span>
<span class="o">&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">plot_stats</span><span class="p">()</span>  <span class="c1"># compared final grain statistics with initial parameters</span>
</pre></div>
</div>
<p>After navigating to the directory where the input file <code class="docutils literal notranslate"><span class="pre">stat_input.json</span></code> is located, kanapy’s CLI
command <code class="docutils literal notranslate"><span class="pre">genStats</span></code> is executed along with its argument (name of the input file). It creates an exemplary
‘Input_distribution.png’ file depicting the Log-normal distribution corresponding to the input statistics defined in
<code class="docutils literal notranslate"><span class="pre">stat_input.json</span></code>. Modifications can be made to the input statistics based on this plot. Next the <code class="docutils literal notranslate"><span class="pre">genRVE</span></code>
command is executed to generate the necessary particle, RVE, and the simulation attributes, and it writes it
to json files. Next the <code class="docutils literal notranslate"><span class="pre">pack</span></code> command is called to run the particle packing simulation. This command looks
for the json files generated by <code class="docutils literal notranslate"><span class="pre">genRVE</span></code> and reads the files for extracting the information required for the
packing simulation. At each time step of the packing simulation, kanapy will write out a dump file containing
information of particle positions and other attributes. Finally, the <code class="docutils literal notranslate"><span class="pre">neperOutput</span></code> command (Optional) can be
called to write out the position and weights files required for further post-processing. This function takes
the specified timestep value as an input parameter and reads the corresponding, previously generated dump file.
By extracting the particle’s position and dimensions, it creates the <code class="docutils literal notranslate"><span class="pre">sphere_positions.txt</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">sphere_weights.txt</span></code> files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">neperOutput</span></code> command requires the simulation timestep as input. The choice of the timestep is very important.
It is suggested to choose the time step at which the spheres are tightly packed and at which there is the least
amount of overlap. The remaining empty spaces will get assigned to the closest sphere when it is sent to the
tessellation and meshing routine. Please refer to <a class="reference internal" href="applications.html#microstructure-with-equiaxed-grains"><span class="std std-ref">Microstructure with equiaxed grains</span></a> for more details.</p></li>
<li><p>The values of position and weights for Neper will be written in <span class="math notranslate nohighlight">\(\mu m\)</span> scale only.</p></li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For comparing the input and output statistics:</p>
<ol class="arabic simple">
<li><p>The json file <code class="docutils literal notranslate"><span class="pre">particle_data.json</span></code> in the directory <code class="docutils literal notranslate"><span class="pre">../json_files/</span></code> can be used to read the
particle’s equivalent diameter as input statistics.</p></li>
<li><p>After tessellation, Neper can be used to generate the equivalent diameter for output statistics.</p></li>
</ol>
</div>
<p>If the built-in voxelization is prefered, then the <code class="docutils literal notranslate"><span class="pre">voxelize</span></code> command can be called to generate the hexahedral mesh.
It populates the simulation box with voxels and assigns the voxels to the respective particles (Spheres). The
<code class="docutils literal notranslate"><span class="pre">abaqusOutput</span></code> command can be called to write out the Abaqus (.inp) input file. The workflow for this looks like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>knpy
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>kanapy-master/examples/sphere_packing/
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>genStats<span class="w"> </span>-f<span class="w"> </span>stat_input.json
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>genRVE<span class="w"> </span>-f<span class="w"> </span>stat_input.json
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>pack
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>voxelize
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>abaqusOutput
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>outputStats
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>plotStats
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The Abaqus (.inp) file will be written out in either <span class="math notranslate nohighlight">\(mm\)</span> or <span class="math notranslate nohighlight">\(\mu m\)</span> scale, depending
on the user requirement specified in the input file.</p></li>
<li><p>For comparing the input and the output equivalent diameter statistics the <code class="docutils literal notranslate"><span class="pre">outputStats</span></code> command can be
called. This command writes the diameter values in either <span class="math notranslate nohighlight">\(mm\)</span> or <span class="math notranslate nohighlight">\(\mu m\)</span> scale, depending
on the user requirement specified in the input file.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">outputStats</span></code> command also writes out the L1-error between the input and output diameter distributions.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">plotStats</span></code> command outputs a figure comparing the input and output diameter distributions.</p></li>
</ol>
</div>
<p>Storing information in json &amp; dump files is effective in making the workflow stages independent of one another.
But the sequence of the workflow is important, for example: Running the packing routine before the statistics generation
is not advised as the packing routine would not have any input to work on. Both the json and the dump files are human readable,
and hence they help the user debug the code in case of simulation problems. The dump files can be read by the visualization
software <a class="reference external" href="https://ovito.org/">OVITO</a>; this provides the user a visual aid to understand the physics behind packing. For more information regarding
visualization, refer to <a class="reference internal" href="#visualize-the-packing-simulation"><span class="std std-ref">Visualize the packing simulation</span></a>.</p>
</section>
<section id="workflows-for-ellipsoid-packing">
<h3>Workflows for ellipsoid packing<a class="headerlink" href="#workflows-for-ellipsoid-packing" title="Link to this heading"></a></h3>
<p>This example demonstrates the workflow for generating synthetic microstructures with
elongated grains. The principle involved in generating such microstructures is described
in the sub-section <a class="reference internal" href="applications.html#microstructure-with-elongated-grains"><span class="std std-ref">Microstructure with elongated grains</span></a>. With respect to the final RVE mesh,
the built-in voxelization routine has to be used due to the inavailability of anisotropic tessellation techniques.
The <a class="reference internal" href="kanapy.html#module-kanapy.core.voxelization"><span class="std std-ref">Module voxelization</span></a> will generate a hexahedral element (C3D8) mesh that can be read by the commercial FEM software <a class="reference external" href="https://www.3ds.com/products-services/simulia/products/abaqus/">Abaqus</a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>knpy
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>kanapy-master/examples/ellipsoid_packing/
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>genStats<span class="w"> </span>-f<span class="w"> </span>stat_input.json
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>genRVE<span class="w"> </span>-f<span class="w"> </span>stat_input.json
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>pack
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>voxelize
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>abaqusOutput
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>outputStats
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>plotStats
</pre></div>
</div>
<p>The workflow is similar to the one described earlier for sphere packing. The only difference being, that the <code class="docutils literal notranslate"><span class="pre">neperOutput</span></code>
command is not applicable here. The <code class="docutils literal notranslate"><span class="pre">outputStats</span></code> command not only writes out the equivalent diameters, but also the
major and minor diameters of the ellipsoidal particles and grains.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>A good estimation for the RVE side length values can be made by keeping the following point in mind: The
biggest dimension of the biggest ellipsoid/sphere should fit within the corresponding RVE side length.</p></li>
<li><p>For comparing the input and output equivalent, major and minor diameter statistics, the command
<code class="docutils literal notranslate"><span class="pre">outputStats</span></code> can be called. Kanapy writes the diameter values in either <span class="math notranslate nohighlight">\(mm\)</span> or <span class="math notranslate nohighlight">\(\mu m\)</span> scale,
depending on the user requirement specified in the input file.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">outputStats</span></code> command also writes out the L1-error between the input and output diameter distributions</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">plotStats</span></code> command outputs figures comparing the input and output diameter &amp; aspect ratio distributions.</p></li>
</ol>
</div>
<section id="texture-examples">
<h4>Texture examples<a class="headerlink" href="#texture-examples" title="Link to this heading"></a></h4>
<p>Both examples <code class="docutils literal notranslate"><span class="pre">ODF_reconstruction</span></code> and <code class="docutils literal notranslate"><span class="pre">ODF_reconstruction_with_orientation_assignment</span></code> require MATLAB &amp; MTEX to be
installed in your system. If your kanapy is not configured for texture analysis, please run the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>knpy
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>setupTexture
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>Your MATLAB version must be 2015 and above.</p></li>
<li><p>The required input files must be placed in the working directory from where the kanapy commands are run.</p></li>
</ol>
</div>
</section>
</section>
<section id="workflow-for-odf-reconstruction">
<h3>Workflow for ODF reconstruction<a class="headerlink" href="#workflow-for-odf-reconstruction" title="Link to this heading"></a></h3>
<p>This example demonstrates the workflow for reconstructing ODF from experimental EBSD data. The principle involved
in generating the reduced ODF is described in the sub-section <a class="reference internal" href="applications.html#odf-reconstruction"><span class="std std-ref">ODF reconstruction</span></a>. Kanapy requires the EBSD data
saved as (.mat) file format. In this regard, an exemplary EBSD file (<cite>ebsd_316L.mat</cite>) is provided in the <code class="docutils literal notranslate"><span class="pre">../kanapy-master/examples/ODF_reconstruction/</span></code> folder.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>knpy
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>kanapy-master/examples/ODF_reconstruction/
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>reduceODF<span class="w"> </span>-ebsd<span class="w"> </span>ebsd_316L.mat
</pre></div>
</div>
<p>After navigating to the directory where <code class="docutils literal notranslate"><span class="pre">ebsd_316L.mat</span></code> is located, kanapy’s CLI
command <code class="docutils literal notranslate"><span class="pre">reduceODF</span></code> is executed along with its argument (name of the EBSD (.mat) file). If kanapy’s
geometry module is executed already, then the number of reduced orientations are read directly. Else kanapy requests
the user to provide the number of reduced orientations required before calling the MATLAB ODF reconstruction algorithm.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The EBSD (.mat) file is a mandatory requirement for the ODF reconstruction algorithm.</p></li>
<li><p>Note here the value of the kernel shape parameter (<span class="math notranslate nohighlight">\(\kappa\)</span>) is set to a default value of 0.0873 rad.</p></li>
</ol>
</div>
<p>Alternatly, an initial kernel shape parameter (<span class="math notranslate nohighlight">\(\kappa\)</span>) can be specified as an user input (OR) the grains
estimated using MTEX can be provided as an input in the (.mat) file format. The value of <span class="math notranslate nohighlight">\(\kappa\)</span> must be in radians,
if user specified. Else if the grains (.mat) file is provided, then the optimum <span class="math notranslate nohighlight">\(\kappa\)</span> is estimated by kanapy using
the mean orientation of the grains. In this regard, an exemplary grains file (<code class="docutils literal notranslate"><span class="pre">grains_316L.mat</span></code>) is
provided in the <code class="docutils literal notranslate"><span class="pre">../kanapy-master/examples/ODF_reconstruction/</span></code> folder. The workflow for this looks like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>knpy
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>kanapy-master/examples/ODF_reconstruction/
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>reduceODF<span class="w"> </span>-ebsd<span class="w"> </span>ebsd_316L.mat<span class="w"> </span>-kernel<span class="w"> </span><span class="m">0</span>.096
<span class="go">                                 (OR)</span>
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>reduceODF<span class="w"> </span>-ebsd<span class="w"> </span>ebsd_316L.mat<span class="w"> </span>-grains<span class="w"> </span>grains_316L.mat
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The output files are saved to the <code class="docutils literal notranslate"><span class="pre">/mat_files</span></code> folder under the current working directory.</p></li>
<li><p>The output (.txt) file contains the following information: <span class="math notranslate nohighlight">\(L_1\)</span> error of ODF reconstruction,
the initial (<span class="math notranslate nohighlight">\(\kappa\)</span>) and the optimized (<span class="math notranslate nohighlight">\(\kappa^\prime\)</span>) values, and a list of discrete orientations.</p></li>
<li><p>Additionaly kanapy saves the reduced ODF and the reduced orientations (.mat) files in this folder.</p></li>
<li><p>Kanapy writes a log file (<code class="docutils literal notranslate"><span class="pre">kanapyTexture.log</span></code>) in the current working directory for possible errors and warnings debugging.</p></li>
</ol>
</div>
</section>
<section id="workflow-for-odf-reconstruction-with-orientation-assignment">
<h3>Workflow for ODF reconstruction with orientation assignment<a class="headerlink" href="#workflow-for-odf-reconstruction-with-orientation-assignment" title="Link to this heading"></a></h3>
<p>This example demonstrates the workflow for reconstructing ODF from experimental EBSD data and then determining the optimal
assignment of orientations to RVE grains. The principle involved in optimal orientation assignment is described in the
sub-section <a class="reference internal" href="applications.html#odf-reconstruction-with-orientation-assignment"><span class="std std-ref">ODF reconstruction with orientation assignment</span></a>. In addition to the EBSD data, Kanapy requires
grain (.mat) file, and the grain boundary shared surface area information as input. In this regard, an exemplary
EBSD file (<code class="docutils literal notranslate"><span class="pre">ebsd_316L.mat</span></code>), and a grains file (<code class="docutils literal notranslate"><span class="pre">grains_316L.mat</span></code>) are provided in the
<code class="docutils literal notranslate"><span class="pre">../kanapy-master/examples/ODF_reconstruction_with_orientation_assignment/</span></code> folder. It is important to note that
the grain boundary shared surface area file is created whilst generating an RVE by kanapy’s geometry module.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>knpy
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>kanapy-master/examples/ODF_reconstruction_orientation_assignment/
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>genStats<span class="w"> </span>-f<span class="w"> </span>stat_input.json
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>genRVE<span class="w"> </span>-f<span class="w"> </span>stat_input.json
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>pack
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>voxelize
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>outputStats
<span class="gp gp-VirtualEnv">(knpy)</span> <span class="gp">$ </span>kanapy<span class="w"> </span>reduceODF<span class="w"> </span>-ebsd<span class="w"> </span>ebsd_316L.mat<span class="w"> </span>-grains<span class="w"> </span>grains_316L.mat<span class="w"> </span>-fit_mad<span class="w"> </span>yes
</pre></div>
</div>
<p>After navigating to the directory where the input file <code class="docutils literal notranslate"><span class="pre">ebsd_316L.mat</span></code> is located, generate an RVE by calling kanapy’s
geometry CLI commands: <code class="docutils literal notranslate"><span class="pre">genStats</span></code>, <code class="docutils literal notranslate"><span class="pre">genRVE</span></code>, <code class="docutils literal notranslate"><span class="pre">pack</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">voxelize</span></code>. To generate the shared surface area file,
run <code class="docutils literal notranslate"><span class="pre">outputStats</span></code> command. Kanapy will write a <code class="docutils literal notranslate"><span class="pre">shared_surfaceArea.csv</span></code>
file to the <code class="docutils literal notranslate"><span class="pre">/json_files/</span></code> folder. This file contains the grain boundary shared surface area
information between neighbouring grains. Now, kanapy’s texture CLI command <code class="docutils literal notranslate"><span class="pre">reduceODF</span></code> can be called along with
its arguments (name of the EBSD, grains (.mat) files). The key <code class="docutils literal notranslate"><span class="pre">-fit_mad</span></code> must be used with this command to tell
kanapy that orientation assignment to grains is required. Since kanapy’s geometry module is executed already, kanapy recognizes
the number of reduced orientations required (=number of grains in the RVE). Else kanapy requests the user to provide
the number of reduced orientations required before calling the MATLAB functions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The EBSD, grains (.mat) files and the grain boundary shared surface file are mandatory requirements for the
orientation assignment algorithm.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">shared_surfaceArea.csv</span></code> file is generated by running <code class="docutils literal notranslate"><span class="pre">kanapy</span> <span class="pre">outputStats</span></code>.</p></li>
</ol>
</div>
<p>Additionally an optional input that can be provided is the grain volume information, which is used for weighting the
orientations after assignment and for estimating the ODF represented by the RVE. Kanapy also writes the grains volume file
(<code class="docutils literal notranslate"><span class="pre">grainsVolumes.csv</span></code>) to the <code class="docutils literal notranslate"><span class="pre">/json_files/</span></code> folder, when the <code class="docutils literal notranslate"><span class="pre">outputStats</span></code> command is executed after RVE generation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">grainsVolumes.csv</span></code> file lists the volume of each grain in the ascending order of the grain ID.</p></li>
<li><p>Kanapy automatically detects the presence of the <code class="docutils literal notranslate"><span class="pre">shared_surfaceArea.csv</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">grainsVolumes.csv</span></code> files,
if they are present in the <code class="docutils literal notranslate"><span class="pre">/json_files/</span></code> folder.</p></li>
<li><p>The output files are saved to the <code class="docutils literal notranslate"><span class="pre">/mat_files</span></code> folder under the current working directory.</p></li>
<li><p>The output (.txt) file contains the following information: <span class="math notranslate nohighlight">\(L_1\)</span> error of ODF reconstruction,
<span class="math notranslate nohighlight">\(L_1\)</span> error between disorientation angle distributions from the EBSD data and the RVE, the initial
(<span class="math notranslate nohighlight">\(\kappa\)</span>) and the optimized (<span class="math notranslate nohighlight">\(\kappa^\prime\)</span>) values, and a list of discrete orientations each
with a specific grain number that it should be assigned to.</p></li>
<li><p>Additionaly kanapy saves the reduced ODF and the reduced orientations (.mat) files in this folder.</p></li>
<li><p>Kanapy writes a log file (<code class="docutils literal notranslate"><span class="pre">kanapyTexture.log</span></code>) in the current working directory for possible errors and warnings debugging.</p></li>
</ol>
</div>
</section>
<section id="visualize-the-packing-simulation">
<h3>Visualize the packing simulation<a class="headerlink" href="#visualize-the-packing-simulation" title="Link to this heading"></a></h3>
<p>You can view the data generated by the simulation (after the simulation
is complete or during the simulation) by launching OVITO and reading in
the dump files generated by kanapy from the <code class="docutils literal notranslate"><span class="pre">../sphere_packing/dump_files/</span></code> directory.
The dump file is generated at each timestep of the particle packing simulation. It contains
the timestep, the number of particles, the simulation box dimensions and the particle’s attributes
such as its ID, position (x, y, z), axes lengths (a, b, c) and tilt angle (Quaternion format - X, Y, Z, W).
The OVITO user interface when loaded, should look similar to this:</p>
<a class="reference internal image-reference" href="_images/UI.png"><img alt="_images/UI.png" src="_images/UI.png" style="width: 750px;" />
</a>
<p>By default, OVITO loads the particles as spheres, this option can be changed to visualize ellipsoids.
The asphericalshapex, asphericalshapey, and asphericalshapez columns need to be mapped to
Aspherical Shape.X, Aspherical Shape.Y, and Aspherical Shape.Z properties of OVITO when
importing the dump file. Similarily, the orientationx, orientationy, orientationz, and
orientationw particle properties need to be mapped to the Orientation.X, Orientation.Y,
Orientation.Z, and Orientation.W. OVITO cannot set up this mapping automatically, you have
to do it manually by using the <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">column</span> <span class="pre">mapping</span></code> button (at the bottom-right corner
of the GUI) in the file import panel after loading the dump files. The required assignment
and components are shown here:</p>
<a class="reference internal image-reference" href="_images/UI_options.png"><img alt="_images/UI_options.png" src="_images/UI_options.png" style="width: 750px;" />
</a>
<p>For further viewing customizations refer to OVITO’s <a class="reference external" href="https://ovito.org/manual/">documentation</a>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="applications.html" class="btn btn-neutral float-left" title="Applications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="method.html" class="btn btn-neutral float-right" title="Modeling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This work is published under a CC BY-SA 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>