

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kanapy.core.plotting &mdash; kanapy 6.5.3.post1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=53ab5b41"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            kanapy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../method.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kanapy.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">kanapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">kanapy.core.plotting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kanapy.core.plotting</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Subroutines for plotting of microstructures</span>

<span class="sd">Created on Mon Oct  4 07:52:55 2021</span>

<span class="sd">@author: Alexander Hartmaier, Golsa Tolooei Eshlaghi, Ronak Shoghi</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">lognorm</span>

<span class="c1">#from PyQt5.QtWidgets import QApplication</span>

<span class="c1">#def dpi_system():</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    A function to get the working system&#39;s DPI</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    app = QApplication(sys.argv)</span>
<span class="c1">#    screen = app.screens()[0]</span>
<span class="c1">#    dpi = screen.physicalDotsPerInch()</span>
<span class="c1">#    app.quit()</span>
<span class="c1">#    return dpi</span>

<span class="c1">#def plot_dpi():</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    Calculates the scaled DPI value for matplotlib</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    system_dpi = 200 #dpi_system()</span>
<span class="c1">#    dpi_scale = 100/system_dpi</span>
<span class="c1">#    matplotlib_dpi = 100 * dpi_scale</span>
<span class="c1">#    return matplotlib_dpi</span>


<div class="viewcode-block" id="plot_voxels_3D">
<a class="viewcode-back" href="../../../kanapy.html#kanapy.core.plotting.plot_voxels_3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_voxels_3D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Ngr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sliced</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;prism&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">clist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">asp_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">phases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot voxels in microstructure, each grain with a different color. Sliced</span>
<span class="sd">    indicates whether one eighth of the box should be removed to see internal</span>
<span class="sd">    structure. With alpha, the transparency of the grains can be adjusted.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : int array</span>
<span class="sd">        Grain number or phase number associated to each voxel</span>
<span class="sd">    Ngr : int, optional</span>
<span class="sd">        Number of grains. The default is 1.</span>
<span class="sd">    sliced : Boolean, optional</span>
<span class="sd">        Indicate if one eighth of box is invisible. The default is False.</span>
<span class="sd">    dual_phase : Boolean, optional</span>
<span class="sd">        Indicate if microstructure is dual phase. The default is False.</span>
<span class="sd">    mask : bool array, optional</span>
<span class="sd">        Mask for voxels to be displayed. The default is None, in which case</span>
<span class="sd">        all voxels will be plotted (except sliced).</span>
<span class="sd">    cmap : color map, optional</span>
<span class="sd">        Color map for voxels. The default is &#39;prism&#39;.</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Adjust transparency of voxels in alpha channel of color map.</span>
<span class="sd">        The default is 1.0.</span>
<span class="sd">    show : bool</span>
<span class="sd">        Indicate whether to show the plot or to return the axis for further use</span>
<span class="sd">    clist : (Ngr, 3)-ndarray</span>
<span class="sd">        List of RGB colors for each grain</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax : matplotlib.axes</span>
<span class="sd">        Axes handle for 3D subplot</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dual_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Use of &quot;dual_phase&quot; is depracted. Use parameter &quot;phases&quot; instead.&#39;</span><span class="p">)</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">dual_phase</span>
    <span class="k">if</span> <span class="n">Ngr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Use of &quot;Ngr&quot; is depracted. Value will be determined automatically.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">]</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">asp_arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asp_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vox_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vox_b</span> <span class="o">=</span> <span class="n">mask</span>
    <span class="k">if</span> <span class="n">phases</span><span class="p">:</span>
        <span class="n">Ngr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Ngr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Ngr</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">clist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">Ngr</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">grl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grl</span> <span class="o">=</span> <span class="n">grl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nz</span><span class="p">):</span>
                    <span class="n">igr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">igr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">grl</span> <span class="o">==</span> <span class="n">igr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">clist</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">sliced</span><span class="p">:</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">vox_b</span><span class="p">[</span><span class="n">ix</span><span class="p">:</span><span class="n">Nx</span><span class="p">,</span> <span class="n">iy</span><span class="p">:</span><span class="n">Ny</span><span class="p">,</span> <span class="n">iz</span><span class="p">:</span><span class="n">Nz</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">colors</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>  <span class="c1"># add semi-transparency</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">voxels</span><span class="p">(</span><span class="n">vox_b</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Voxelated microstructure&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">Nx</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">Ny</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">Nz</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span><span class="n">asp_arr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_polygons_3D">
<a class="viewcode-back" href="../../../kanapy.html#kanapy.core.plotting.plot_polygons_3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_polygons_3D</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;prism&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">dual_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asp_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">phases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot triangularized convex hulls of grains based on vertices and simplices</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary containing grain geometry with keys:</span>
<span class="sd">        - &#39;Grains&#39;: dict with simplices (triangles) for each grain</span>
<span class="sd">        - &#39;Points&#39;: ndarray of vertex coordinates (N, 3)</span>
<span class="sd">    cmap : str, optional</span>
<span class="sd">        Colormap for coloring the triangles. Default is &#39;prism&#39;.</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Transparency of the polygons. Default is 0.4.</span>
<span class="sd">    ec : color or list, optional</span>
<span class="sd">        Edge color for triangles. Default is [0.5, 0.5, 0.5, 0.1].</span>
<span class="sd">    dual_phase : bool, optional</span>
<span class="sd">        Deprecated. Use `phases` instead. If True, grains are colored</span>
<span class="sd">        by phase in red/green contrast.</span>
<span class="sd">    silent : bool, optional</span>
<span class="sd">        If True, returns the figure object instead of showing it. Default is False.</span>
<span class="sd">    asp_arr : list of 3 floats, optional</span>
<span class="sd">        Aspect ratio for the 3D axes (x, y, z). Default is [1, 1, 1].</span>
<span class="sd">    phases : bool, optional</span>
<span class="sd">        If True, colors grains according to their phase number.</span>
<span class="sd">    cols : list of str, optional</span>
<span class="sd">        Colors to use for each phase when `phases=True`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure, optional</span>
<span class="sd">        Matplotlib figure object if `silent=True`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The `dual_phase` parameter is deprecated. Use `phases` to control</span>
<span class="sd">      coloring by phase.</span>
<span class="sd">    - Each grain is plotted using its convex hull triangles defined in</span>
<span class="sd">      `geometry[&#39;Grains&#39;][igr][&#39;Simplices&#39;]`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dual_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Use of &quot;dual_phase&quot; is depracted. Use parameter &quot;phases&quot; instead.&#39;</span><span class="p">)</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">dual_phase</span>
    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">asp_arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asp_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">grains</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;Grains&#39;</span><span class="p">]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;Points&#39;</span><span class="p">]</span>
    <span class="n">Ng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">grains</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">Ng</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">igr</span> <span class="ow">in</span> <span class="n">grains</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">grains</span><span class="p">[</span><span class="n">igr</span><span class="p">][</span><span class="s1">&#39;Simplices&#39;</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">phases</span><span class="p">:</span>
            <span class="n">icol</span> <span class="o">=</span> <span class="n">grains</span><span class="p">[</span><span class="n">igr</span><span class="p">][</span><span class="s1">&#39;Phase&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">icol</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">icol</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">igr</span><span class="p">))</span>
            <span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>  <span class="c1"># change alpha channel to create semi-transparency</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">triangles</span><span class="o">=</span><span class="n">grains</span><span class="p">[</span><span class="n">igr</span><span class="p">][</span><span class="s1">&#39;Simplices&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Polygonized microstructure&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span><span class="n">asp_arr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>




<div class="viewcode-block" id="plot_ellipsoids_3D">
<a class="viewcode-back" href="../../../kanapy.html#kanapy.core.plotting.plot_ellipsoids_3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_ellipsoids_3D</span><span class="p">(</span><span class="n">particles</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;prism&#39;</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asp_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">phases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display ellipsoids after the packing procedure</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    particles : list</span>
<span class="sd">        List of ellipsoid objects representing particles in the microstructure.</span>
<span class="sd">    cmap : str, optional</span>
<span class="sd">        Color map for ellipsoids. Default is &#39;prism&#39;.</span>
<span class="sd">    dual_phase : bool, optional</span>
<span class="sd">        Deprecated. Use `phases` instead. If True, ellipsoids are colored</span>
<span class="sd">        according to phase (red/green contrast).</span>
<span class="sd">    silent : bool, optional</span>
<span class="sd">        If True, returns the figure object without displaying it. Default is False.</span>
<span class="sd">    asp_arr : list of 3 floats, optional</span>
<span class="sd">        Aspect ratio for the 3D axes (x, y, z). Default is [1, 1, 1].</span>
<span class="sd">    phases : bool, optional</span>
<span class="sd">        If True, ellipsoids are colored according to their phase number.</span>
<span class="sd">    cols : list of str, optional</span>
<span class="sd">        List of colors used for each phase when `phases=True`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure, optional</span>
<span class="sd">        The matplotlib figure object if `silent=True`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The `dual_phase` parameter is deprecated. Use `phases` to control</span>
<span class="sd">      coloring by phase.</span>
<span class="sd">    - Each ellipsoid is represented by its surface mesh generated via</span>
<span class="sd">      `surfacePointsGen` method of the ellipsoid object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">asp_arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asp_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dual_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Use of &quot;dual_phase&quot; is depracted. Use parameter &quot;phases&quot; instead.&#39;</span><span class="p">)</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">dual_phase</span>
    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">Npa</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">Npa</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">phases</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">particles</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pa</span><span class="o">.</span><span class="n">duplicate</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">phases</span><span class="p">:</span>
            <span class="n">icol</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">phasenum</span>
            <span class="k">if</span> <span class="n">icol</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">icol</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cm</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">surfacePointsGen</span><span class="p">(</span><span class="n">nang</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ctr</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span><span class="n">asp_arr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>




<div class="viewcode-block" id="plot_particles_3D">
<a class="viewcode-back" href="../../../kanapy.html#kanapy.core.plotting.plot_particles_3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_particles_3D</span><span class="p">(</span><span class="n">particles</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;prism&#39;</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asp_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display inner polyhedra and optional hulls of ellipsoids after packing procedure</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    particles : list</span>
<span class="sd">        List of ellipsoid objects containing inner polygons and convex hulls.</span>
<span class="sd">    cmap : str, optional</span>
<span class="sd">        Colormap for ellipsoids. Default is &#39;prism&#39;.</span>
<span class="sd">    dual_phase : bool, optional</span>
<span class="sd">        If True, colors ellipsoids according to phase (red/green contrast).</span>
<span class="sd">    plot_hull : bool, optional</span>
<span class="sd">        If True, plots the outer hull of the ellipsoid. Default is True.</span>
<span class="sd">    silent : bool, optional</span>
<span class="sd">        If True, returns the figure object instead of displaying the plot.</span>
<span class="sd">    asp_arr : list of 3 floats, optional</span>
<span class="sd">        Aspect ratio for the 3D axes (x, y, z). Default is [1, 1, 1].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure, optional</span>
<span class="sd">        Matplotlib figure object if `silent=True`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Each ellipsoid must have an inner polygon (`pa.inner`) to be plotted.</span>
<span class="sd">    - The convex hull of the ellipsoid is displayed using `plot_trisurf`.</span>
<span class="sd">    - If `plot_hull` is True, the outer surface of the ellipsoid is also plotted</span>
<span class="sd">      using `plot_surface`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">asp_arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asp_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

    <span class="n">Npa</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">Npa</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">particles</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pa</span><span class="o">.</span><span class="n">duplicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">pa</span><span class="o">.</span><span class="n">inner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ellipsoid </span><span class="si">{</span><span class="n">pa</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> without inner polygon cannot be plotted.&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">dual_phase</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pa</span><span class="o">.</span><span class="n">phasenum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
            <span class="k">elif</span> <span class="n">pa</span><span class="o">.</span><span class="n">phasenum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">cm</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># set to &#39;b&#39; for only blue ellipsoids</span>
        <span class="n">pa</span><span class="o">.</span><span class="n">sync_poly</span><span class="p">()</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">points</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">triangles</span><span class="o">=</span><span class="n">pa</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">convex_hull</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_hull</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">surfacePointsGen</span><span class="p">(</span><span class="n">nang</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">ctr</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctr</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctr</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
            <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ctr</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span><span class="n">asp_arr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_output_stats">
<a class="viewcode-back" href="../../../kanapy.html#kanapy.core.plotting.plot_output_stats">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_output_stats</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">iphase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">gs_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gs_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">ar_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ar_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enhanced_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate and plot particle- and RVE grain statistics, including equivalent diameters and aspect ratios</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_list : list of dict</span>
<span class="sd">        List of dictionaries containing particle/grain statistics. Each dictionary</span>
<span class="sd">        should include keys like &#39;eqd&#39;, &#39;eqd_scale&#39;, &#39;eqd_sig&#39;, &#39;ar&#39;, &#39;ar_scale&#39;, &#39;ar_sig&#39;.</span>
<span class="sd">    labels : list of str</span>
<span class="sd">        Labels indicating the type of data in `data_list`, e.g., [&#39;Grains&#39;, &#39;Partcls&#39;].</span>
<span class="sd">    iphase : int, optional</span>
<span class="sd">        Phase index to label the plots. Default is None.</span>
<span class="sd">    gs_data : array-like, optional</span>
<span class="sd">        Experimental equivalent diameter data for comparison. Default is None.</span>
<span class="sd">    gs_param : tuple, optional</span>
<span class="sd">        Parameters for lognormal distribution of experimental data (s, loc, scale). Default is None.</span>
<span class="sd">    ar_data : array-like, optional</span>
<span class="sd">        Experimental aspect ratio data for comparison. Default is None.</span>
<span class="sd">    ar_param : tuple, optional</span>
<span class="sd">        Parameters for lognormal distribution of experimental aspect ratio data (s, loc, scale). Default is None.</span>
<span class="sd">    save_files : bool, optional</span>
<span class="sd">        If True, saves the generated figures as PNG files. Default is False.</span>
<span class="sd">    silent : bool, optional</span>
<span class="sd">        If True, returns the figure objects instead of showing them. Default is False.</span>
<span class="sd">    enhanced_plot : bool, optional</span>
<span class="sd">        If True, produces higher-resolution comparison plots using lognormal PDFs. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure, optional</span>
<span class="sd">        Figure object if `silent=True`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function can compare statistical distributions between grains, particles, and experimental data.</span>
<span class="sd">    - Both histograms and lognormal probability density functions are used to display distributions.</span>
<span class="sd">    - If `enhanced_plot=True`, PDFs for equivalent diameter and aspect ratio are plotted using a dense x-axis.</span>
<span class="sd">    - `labels` must contain at least &#39;Grains&#39; or &#39;Voxels&#39;. Otherwise, a ValueError is raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;Grains&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span> <span class="ow">and</span> <span class="s1">&#39;Voxels&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Argument &quot;labels&quot;: </span><span class="si">{</span><span class="n">labels</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either grains or voxels must be provided in labaels for statistical analysis.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Grains&#39;</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="c1"># if grain information is given plot this for comparison</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Grains&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise use voxel statistics</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Voxels&#39;</span><span class="p">)</span>
    <span class="c1"># process equiv. diameter data</span>
    <span class="n">grain_eqDia</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;eqd&#39;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">grain_eqDia</span><span class="p">]</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
    <span class="n">mu_gr</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;eqd_scale&#39;</span><span class="p">]</span>
    <span class="n">std_gr</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;eqd_sig&#39;</span><span class="p">]</span>
    <span class="n">grain_lognorm</span> <span class="o">=</span> <span class="n">lognorm</span><span class="p">(</span><span class="n">std_gr</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">mu_gr</span><span class="p">)</span>
    <span class="c1"># process aspect ratio data</span>
    <span class="n">grain_AR</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;ar&#39;</span><span class="p">]</span>
    <span class="n">sig_ar</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;ar_sig&#39;</span><span class="p">]</span>
    <span class="n">sc_ar</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;ar_scale&#39;</span><span class="p">]</span>
    <span class="n">ar_lognorm</span> <span class="o">=</span> <span class="n">lognorm</span><span class="p">(</span><span class="n">sig_ar</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sc_ar</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;Partcls&#39;</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Partcls&#39;</span><span class="p">)</span>
        <span class="n">par_eqDia</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;eqd&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_eqDia</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Particles&#39;</span><span class="p">)</span>

        <span class="n">total_eqDia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">mu_par</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;eqd_scale&#39;</span><span class="p">]</span>
        <span class="n">std_par</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;eqd_sig&#39;</span><span class="p">]</span>
        <span class="n">par_lognorm</span> <span class="o">=</span> <span class="n">lognorm</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">std_par</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">mu_par</span><span class="p">)</span>
        <span class="n">par_AR</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;ar&#39;</span><span class="p">]</span>
        <span class="n">particles</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">par_eqDia</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">total_eqDia</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">particles</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">gs_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gs_data</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Experiment&#39;</span><span class="p">)</span>
        <span class="n">total_eqDia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">total_eqDia</span><span class="p">,</span> <span class="n">gs_data</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">enhanced_plot</span><span class="p">:</span>
        <span class="c1"># Determine x-axis limits for equivalent diameter</span>
        <span class="n">dia_cutoff_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">total_eqDia</span><span class="p">)</span>
        <span class="n">dia_cutoff_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">total_eqDia</span><span class="p">)</span>
        <span class="n">x_lim_dia</span> <span class="o">=</span> <span class="n">dia_cutoff_max</span> <span class="c1"># * 1.5</span>

        <span class="c1"># Plot the equivalent diameter PDF</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">xaxis_dia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dia_cutoff_min</span><span class="p">,</span> <span class="n">x_lim_dia</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="c1"># plot lognormal distribution of stats parameters</span>
        <span class="k">if</span> <span class="n">gs_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xaxis_dia</span><span class="p">,</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">gs_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">gs_param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;area = np.trapz(y, xaxis_dia)</span>
<span class="sd">            if np.isclose(area, 0.):</span>
<span class="sd">                logging.debug(f&#39;Expt. AREA interval: {np.min(xaxis_dia)}, {np.max(xaxis_dia)}&#39;)</span>
<span class="sd">                logging.debug(np.amin(grain_eqDia))</span>
<span class="sd">                logging.debug(np.amax(grain_eqDia))</span>
<span class="sd">                area = 1.</span>
<span class="sd">            y /= area&quot;&quot;&quot;</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis_dia</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis_dia</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="c1"># Plot PDF for equivalent diameter</span>
        <span class="n">ypdf2</span> <span class="o">=</span> <span class="n">grain_lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xaxis_dia</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;area = np.trapz(ypdf2, xaxis_dia)</span>
<span class="sd">        if np.isclose(area, 0.):</span>
<span class="sd">            logging.debug(f&#39;Grain AREA interval: {area}&#39;)</span>
<span class="sd">            logging.debug(np.amin(xaxis_dia))</span>
<span class="sd">            logging.debug(np.amax(xaxis_dia))</span>
<span class="sd">            area = 1.</span>
<span class="sd">        ypdf2 /= area&quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis_dia</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis_dia</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Equivalent diameter (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">dia_cutoff_min</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim_dia</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iphase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Equivalent Diameter Distribution - Phase </span><span class="si">{</span><span class="n">iphase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Determine x-axis limits for aspect ratio</span>
        <span class="n">ar_cutoff_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">grain_AR</span><span class="p">)</span>
        <span class="n">ar_cutoff_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">grain_AR</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">particles</span><span class="p">:</span>
            <span class="n">ar_cutoff_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">par_AR</span><span class="p">))</span>
            <span class="n">ar_cutoff_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ar_cutoff_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">par_AR</span><span class="p">))</span>
        <span class="n">x_lim_ar</span> <span class="o">=</span> <span class="n">ar_cutoff_max</span>  <span class="c1"># * 1.5</span>
        <span class="n">xaxis_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="n">x_lim_ar</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="c1"># plot lognormal distribution for aspect ratio parameters</span>
        <span class="k">if</span> <span class="n">ar_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xaxis_ar</span><span class="p">,</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">ar_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">ar_param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;area = np.trapz(y, xaxis_ar)</span>
<span class="sd">            y /= area&quot;&quot;&quot;</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis_ar</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis_ar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="c1"># Plot the PDF for aspect ratio</span>
        <span class="n">ypdf2</span> <span class="o">=</span> <span class="n">ar_lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xaxis_ar</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;area = np.trapz(ypdf2, xaxis_ar)</span>
<span class="sd">        if np.isclose(area, 0.0):</span>
<span class="sd">            logging.debug(&#39;Small area for aspect ratio of grains.&#39;)</span>
<span class="sd">            logging.debug(ypdf2, xaxis_ar)</span>
<span class="sd">            area = 1.0</span>
<span class="sd">        ypdf2 /= area&quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis_ar</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis_ar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">ar_cutoff_min</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim_ar</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iphase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Aspect Ratio Distribution - Phase </span><span class="si">{</span><span class="n">iphase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_files</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;equiv_diameter_and_aspect_ratio_comp.png&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&#39; is placed in the current working directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># NOTE: &#39;fd&#39; produces better estimates for non-normal datasets</span>
        <span class="n">shared_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">total_eqDia</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">)</span>
        <span class="n">binNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_bins</span><span class="p">)</span>

        <span class="c1"># Plot the histogram &amp; PDF for equivalent diameter</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># Plot histogram</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">binNum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;equivalent diameter (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iphase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Phase </span><span class="si">{</span><span class="n">iphase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Plot PDF</span>
        <span class="n">ypdf2</span> <span class="o">=</span> <span class="n">grain_lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">grain_eqDia</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;area = np.trapz(ypdf2, grain_eqDia)</span>
<span class="sd">        if np.isclose(area, 0.):</span>
<span class="sd">            logging.debug(f&#39;Grain AREA interval: {area}&#39;)</span>
<span class="sd">            logging.debug(np.amin(grain_eqDia))</span>
<span class="sd">            logging.debug(np.amax(grain_eqDia))</span>
<span class="sd">            area = 1.</span>
<span class="sd">        ypdf2 /= area&quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grain_eqDia</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">grain_eqDia</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">particles</span><span class="p">:</span>
            <span class="c1">#par_lognorm = lognorm(std_par, scale=mu_par)</span>
            <span class="n">ypdf1</span> <span class="o">=</span> <span class="n">par_lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">par_eqDia</span><span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;area = np.trapz(ypdf1, par_eqDia)</span>
<span class="sd">            if np.isclose(area, 0.):</span>
<span class="sd">                logging.debug(f&#39;Particle AREA interval: {area}&#39;)</span>
<span class="sd">                logging.debug(np.amin(par_eqDia))</span>
<span class="sd">                logging.debug(np.amax(par_eqDia))</span>
<span class="sd">                area = 1.</span>
<span class="sd">            ypdf1 /= area&quot;&quot;&quot;</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">par_eqDia</span><span class="p">,</span> <span class="n">ypdf1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Particles&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">par_eqDia</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">grain_eqDia</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">grain_eqDia</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">particles</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">par_eqDia</span><span class="p">),</span> <span class="n">x0</span><span class="p">)</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">par_eqDia</span><span class="p">),</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">gs_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">gs_param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;area = np.trapz(y, x)</span>
<span class="sd">            if np.isclose(area, 0.):</span>
<span class="sd">                logging.debug(f&#39;Expt. AREA interval: {x0}, {x1}&#39;)</span>
<span class="sd">                logging.debug(np.amin(grain_eqDia))</span>
<span class="sd">                logging.debug(np.amax(grain_eqDia))</span>
<span class="sd">                area = 1.</span>
<span class="sd">            y /= area&quot;&quot;&quot;</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experiment&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;equivalent diameter (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iphase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Phase </span><span class="si">{</span><span class="n">iphase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_files</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;equiv_diameter_comp.png&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    &#39;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&#39; is placed in the current working directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Plot the aspect ratio comparison</span>
        <span class="k">if</span> <span class="n">particles</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Partcls&#39;</span><span class="p">)</span>
            <span class="n">par_AR</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;ar&#39;</span><span class="p">]</span>
            <span class="c1"># Concatenate corresponding arrays to compute shared bins</span>
            <span class="n">total_AR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">grain_AR</span><span class="p">,</span> <span class="n">par_AR</span><span class="p">])</span>
            <span class="n">sig_par</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;ar_sig&#39;</span><span class="p">]</span>
            <span class="n">sc_par</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;ar_scale&#39;</span><span class="p">]</span>
            <span class="n">par_lognorm</span> <span class="o">=</span> <span class="n">lognorm</span><span class="p">(</span><span class="n">sig_par</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sc_par</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">grain_AR</span><span class="p">,</span> <span class="n">par_AR</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_AR</span> <span class="o">=</span> <span class="n">grain_AR</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">grain_AR</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ar_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ar_data</span><span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Experiment&#39;</span><span class="p">)</span>
        <span class="c1"># Find the corresponding shared bin edges</span>
        <span class="n">shared_AR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">total_AR</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">)</span>

        <span class="c1"># Plot the histogram &amp; PDF</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
        <span class="c1"># Plot histogram</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">shared_AR</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;aspect ratio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iphase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Phase </span><span class="si">{</span><span class="n">iphase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Plot PDF</span>
        <span class="n">ypdf2</span> <span class="o">=</span> <span class="n">ar_lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">grain_AR</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;area = np.trapz(ypdf2, grain_AR)</span>
<span class="sd">        if np.isclose(area, 0.0):</span>
<span class="sd">            logging.debug(&#39;Small area for aspect ratio of grains.&#39;)</span>
<span class="sd">            logging.debug(ypdf2, grain_AR)</span>
<span class="sd">            area = 1.0</span>
<span class="sd">        ypdf2 /= area&quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grain_AR</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">grain_AR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">particles</span><span class="p">:</span>
            <span class="n">ypdf1</span> <span class="o">=</span> <span class="n">par_lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">par_AR</span><span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;area = np.trapz(ypdf1, par_AR)</span>
<span class="sd">            ypdf1 /= area&quot;&quot;&quot;</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">par_AR</span><span class="p">,</span> <span class="n">ypdf1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Particles&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">par_AR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ar_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">grain_AR</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">grain_AR</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">particles</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">par_AR</span><span class="p">))</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">par_AR</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">ar_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">ar_param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;area = np.trapz(y, x)</span>
<span class="sd">            y /= area&quot;&quot;&quot;</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experiment&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;aspect ratio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iphase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Phase </span><span class="si">{</span><span class="n">iphase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_files</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;aspect_ratio_comp.png&quot;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    &#39;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&#39; is placed in the current working directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span></div>



<div class="viewcode-block" id="plot_init_stats">
<a class="viewcode-back" href="../../../kanapy.html#kanapy.core.plotting.plot_init_stats">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_init_stats</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">,</span>
                    <span class="n">gs_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ar_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">gs_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ar_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot initial microstructure descriptors (grain size and aspect ratio) based on user-defined statistics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stats_dict : dict</span>
<span class="sd">        Dictionary containing initial microstructure statistics. Expected keys:</span>
<span class="sd">        - &quot;Equivalent diameter&quot;: dict with &#39;sig&#39;, &#39;scale&#39;, optionally &#39;loc&#39;, &#39;cutoff_min&#39;, &#39;cutoff_max&#39;</span>
<span class="sd">        - &quot;Aspect ratio&quot;: dict with &#39;sig&#39;, &#39;scale&#39;, optionally &#39;loc&#39;, &#39;cutoff_min&#39;, &#39;cutoff_max&#39; (for elongated grains)</span>
<span class="sd">        - &quot;Grain type&quot;: str, one of &quot;Equiaxed&quot;, &quot;Elongated&quot;, or &quot;Free&quot;</span>
<span class="sd">        - &quot;Semi axes&quot;: dict with &#39;scale&#39;, &#39;sig&#39;, &#39;cutoff_min&#39;, &#39;cutoff_max&#39; (for free grains)</span>
<span class="sd">        - &quot;Phase&quot;: dict with &#39;Number&#39; and &#39;Name&#39;, optional</span>
<span class="sd">    gs_data : array-like, optional</span>
<span class="sd">        Experimental equivalent diameter data. Default is None.</span>
<span class="sd">    ar_data : array-like, optional</span>
<span class="sd">        Experimental aspect ratio data. Default is None.</span>
<span class="sd">    gs_param : tuple, optional</span>
<span class="sd">        Parameters (s, loc, scale, min, max) for lognormal distribution of experimental equivalent diameters. Default is None.</span>
<span class="sd">    ar_param : tuple, optional</span>
<span class="sd">        Parameters (s, loc, scale, min, max) for lognormal distribution of experimental aspect ratios. Default is None.</span>
<span class="sd">    save_files : bool, optional</span>
<span class="sd">        If True, save the figure to file &quot;Input_distribution.png&quot;. Default is False.</span>
<span class="sd">    silent : bool, optional</span>
<span class="sd">        If True, return the figure object instead of displaying it. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure, optional</span>
<span class="sd">        The figure object if `silent=True`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function automatically selects plotting style depending on &quot;Grain type&quot;:</span>
<span class="sd">        - &quot;Equiaxed&quot;: only equivalent diameter distribution</span>
<span class="sd">        - &quot;Elongated&quot;: both equivalent diameter and aspect ratio distributions</span>
<span class="sd">        - &quot;Free&quot;: compute aspect ratio from semi-axes and rotation axis</span>
<span class="sd">    - Vertical dashed lines mark the minimum and maximum cut-offs from `stats_dict`.</span>
<span class="sd">    - Overlays experimental data (histogram) and lognormal fits if `gs_data` or `ar_data` are provided.</span>
<span class="sd">    - Uses lognormal PDFs for both grain size and aspect ratio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_lognorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a log-normal probability density function (PDF) on a given matplotlib axis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array-like</span>
<span class="sd">            Points at which to evaluate the PDF.</span>
<span class="sd">        sig : float</span>
<span class="sd">            Shape parameter (standard deviation of log of the variable).</span>
<span class="sd">        loc : float</span>
<span class="sd">            Location parameter (shifts the distribution along x-axis).</span>
<span class="sd">        scale : float</span>
<span class="sd">            Scale parameter (exp(mean of log of the variable)).</span>
<span class="sd">        axis : matplotlib.axes.Axes</span>
<span class="sd">            Matplotlib axis to plot the PDF on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;area = np.trapz(y, xv)</span>
<span class="sd">        if np.isclose(area, 0.0):</span>
<span class="sd">            area = 1.</span>
<span class="sd">        y /= area&quot;&quot;&quot;</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Output stats&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Extract grain diameter statistics info from input file</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Equivalent diameter&quot;</span><span class="p">][</span><span class="s2">&quot;sig&quot;</span><span class="p">]</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Equivalent diameter&quot;</span><span class="p">][</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;loc&#39;</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Equivalent diameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Equivalent diameter&quot;</span><span class="p">][</span><span class="s2">&quot;loc&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">dia_cutoff_min</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Equivalent diameter&quot;</span><span class="p">][</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span>
    <span class="n">dia_cutoff_max</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Equivalent diameter&quot;</span><span class="p">][</span><span class="s2">&quot;cutoff_max&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;Phase&quot;</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Microstructure statistics of phase </span><span class="si">{</span><span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Phase&quot;</span><span class="p">][</span><span class="s2">&quot;Number&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
                 <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Phase&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Microstructure statistics&#39;</span><span class="p">)</span>

    <span class="n">x_lim_eqd</span> <span class="o">=</span> <span class="n">dia_cutoff_max</span> <span class="o">*</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">gs_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_lim_eqd</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_lim_eqd</span><span class="p">,</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>

    <span class="c1"># Compute the Log-normal PDF</span>
    <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">x_lim_eqd</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">ypdf</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
    <span class="c1"># normalize density to region between min and max cutoff</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">xaxis</span> <span class="o">&gt;=</span> <span class="n">dia_cutoff_min</span><span class="p">,</span> <span class="n">xaxis</span> <span class="o">&lt;=</span> <span class="n">dia_cutoff_max</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;if gs_data is None:</span>
<span class="sd">        area = np.trapz(ypdf[ind], xaxis[ind])</span>
<span class="sd">        if np.isclose(area, 0.0):</span>
<span class="sd">            area = 1.</span>
<span class="sd">        ypdf /= area&quot;&quot;&quot;</span>
    <span class="c1"># set colorcodes</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Grain type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Equiaxed&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="c1"># plt.ion()</span>

        <span class="c1"># Plot grain size distribution</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dia_cutoff_min</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Minimum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dia_cutoff_min</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dia_cutoff_max</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dia_cutoff_max</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input stats&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim_eqd</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Equivalent diameter (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">gs_data</span> <span class="o">&lt;</span> <span class="n">x_lim_eqd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gs_data</span><span class="p">[</span><span class="n">idata</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs_param</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">xaxis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gs_param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">plot_lognorm</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Grain type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Elongated&quot;</span><span class="p">]:</span>
        <span class="c1"># Extract grain aspect ratio descriptors from input file</span>
        <span class="n">sd_AR</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Aspect ratio&quot;</span><span class="p">][</span><span class="s2">&quot;sig&quot;</span><span class="p">]</span>
        <span class="n">scale_AR</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Aspect ratio&quot;</span><span class="p">][</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;loc&#39;</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Aspect ratio&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">loc_AR</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Aspect ratio&quot;</span><span class="p">][</span><span class="s2">&quot;loc&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loc_AR</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ar_cutoff_min</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Aspect ratio&quot;</span><span class="p">][</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span>
        <span class="n">ar_cutoff_max</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Aspect ratio&quot;</span><span class="p">][</span><span class="s2">&quot;cutoff_max&quot;</span><span class="p">]</span>

        <span class="n">x_lim_ar</span> <span class="o">=</span> <span class="n">ar_cutoff_max</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">ar_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_lim_ar</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_lim_ar</span><span class="p">,</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)</span>

        <span class="c1"># Plot grain size distribution</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dia_cutoff_min</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Minimum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dia_cutoff_min</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dia_cutoff_max</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dia_cutoff_max</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input stats&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim_eqd</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Equivalent diameter (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gs_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;experimental data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs_param</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">xaxis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gs_param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">plot_lognorm</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="c1"># Plot aspect ratio statistics</span>
        <span class="c1"># Compute the Log-normal PDF</span>
        <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ar_cutoff_max</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ypdf</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">sd_AR</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc_AR</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale_AR</span><span class="p">)</span>
        <span class="c1"># normalize density to region between min and max cutoff</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">xaxis</span> <span class="o">&gt;=</span> <span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="n">xaxis</span> <span class="o">&lt;=</span> <span class="n">ar_cutoff_max</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;if ar_data is None:</span>
<span class="sd">            area = np.trapz(ypdf[ind], xaxis[ind])</span>
<span class="sd">            if np.isclose(area, 0.0):</span>
<span class="sd">                area = 1.</span>
<span class="sd">            ypdf /= area&quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Minimum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ar_cutoff_min</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ar_cutoff_max</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ar_cutoff_max</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input stats&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim_ar</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ar_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ar_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ar_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs_param</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">xaxis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ar_param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">plot_lognorm</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Grain type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Free&quot;</span><span class="p">]:</span>
        <span class="c1"># Compute reference grain aspect ratio descriptors from stats dict</span>
        <span class="c1"># Identify most likely rotation axis of ellepsoid with free semi-axes</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">kanapy.rve_stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_rot_axis</span>
        <span class="n">semi_axs</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Semi axes&quot;</span><span class="p">][</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span>
        <span class="n">cut_min</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Semi axes&quot;</span><span class="p">][</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span>
        <span class="n">cut_max</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Semi axes&quot;</span><span class="p">][</span><span class="s2">&quot;cutoff_max&quot;</span><span class="p">]</span>
        <span class="n">irot</span> <span class="o">=</span> <span class="n">find_rot_axis</span><span class="p">(</span><span class="n">semi_axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">irot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ar_scale</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">semi_axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ar_cutoff_min</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cut_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cut_min</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cut_min</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ar_cutoff_max</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cut_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cut_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cut_max</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">irot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ar_scale</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">semi_axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ar_cutoff_min</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cut_min</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cut_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cut_min</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ar_cutoff_max</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cut_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cut_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cut_max</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">irot</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ar_scale</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">semi_axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">semi_axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ar_cutoff_min</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cut_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cut_min</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cut_min</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ar_cutoff_max</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cut_max</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cut_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cut_max</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Rotation axis not identified properly&#39;</span><span class="p">)</span>
        <span class="n">ar_sig</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;Semi axes&quot;</span><span class="p">][</span><span class="s2">&quot;sig&quot;</span><span class="p">][</span><span class="n">irot</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

        <span class="c1"># Plot grain size distribution</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dia_cutoff_min</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Minimum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dia_cutoff_min</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dia_cutoff_max</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dia_cutoff_max</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input stats&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim_eqd</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Equivalent diameter (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gs_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs_param</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">xaxis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gs_param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">plot_lognorm</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gs_param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="c1"># Plot aspect ratio statistics</span>
        <span class="c1"># Compute the Log-normal PDF</span>
        <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ar_cutoff_max</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ypdf</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ar_sig</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ar_scale</span><span class="p">)</span>
        <span class="c1"># normalize density to region between min and max cutoff</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">xaxis</span> <span class="o">&gt;=</span> <span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="n">xaxis</span> <span class="o">&lt;=</span> <span class="n">ar_cutoff_max</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;area = np.trapz(ypdf[ind], xaxis[ind])</span>
<span class="sd">        if np.isclose(area, 0.0):</span>
<span class="sd">            area = 1.</span>
<span class="sd">        ypdf /= area&quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ar_cutoff_min</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Minimum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ar_cutoff_min</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ar_cutoff_max</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum cut-off: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ar_cutoff_max</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input stats&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xaxis</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ar_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ar_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ar_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs_param</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">xaxis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ar_param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">plot_lognorm</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ar_param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value for &quot;Grain_type&quot; must be either &quot;Equiaxed&quot; or &quot;Elongated&quot;.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_files</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;Input_distribution.png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
            <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press [enter] to continue&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input_distribution.png saved in the current working directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_stats_dict">
<a class="viewcode-back" href="../../../kanapy.html#kanapy.core.plotting.plot_stats_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_stats_dict</span><span class="p">(</span><span class="n">sdict</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot statistical data on semi-axes of effective ellipsoids in RVE as histogram</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdict : dict</span>
<span class="sd">        Dictionary containing semi-axis data and log-normal parameters.</span>
<span class="sd">        Keys should include &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, and their corresponding &#39;_sig&#39; and &#39;_scale&#39;.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title for the plot</span>
<span class="sd">    save_files : bool, optional</span>
<span class="sd">        Whether to save the plot as PNG in the current working directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shared_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;eqd&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">)</span>
    <span class="n">binNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_bins</span><span class="p">)</span>
    <span class="c1"># Plot the histogram &amp; PDF for equivalent diameter</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Plot PDF</span>

    <span class="n">loc</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sig = sdict[&#39;eqd_sig&#39;]</span>
<span class="sd">    sc = sdict[&#39;eqd_scale&#39;]</span>
<span class="sd">    xval = np.linspace(np.min(sdict[&#39;eqd&#39;]), np.max(sdict[&#39;eqd&#39;]), 50, endpoint=True)</span>
<span class="sd">    ypdf = lognorm.pdf(xval, sig, loc=loc, scale=sc)</span>
<span class="sd">    plt.figure(figsize=(12, 9))</span>
<span class="sd">    plt.plot(xval, ypdf, linestyle=&#39;-&#39;, linewidth=3.0, label=&#39;PDF&#39;)</span>
<span class="sd">    plt.fill_between(xval, 0, ypdf, alpha=0.3)</span>
<span class="sd">    # Plot histogram</span>
<span class="sd">    plt.hist(sdict[&#39;eqd&#39;], density=True, bins=binNum, label=&#39;Data&#39;)</span>
<span class="sd">    plt.legend(loc=&quot;upper right&quot;, fontsize=16)</span>
<span class="sd">    plt.xlabel(&#39;equivalent diameter (m)&#39;, fontsize=16)</span>
<span class="sd">    plt.ylabel(&#39;density&#39;, fontsize=16)</span>
<span class="sd">    plt.tick_params(labelsize=14)</span>
<span class="sd">    if title is not None:</span>
<span class="sd">        plt.title(title, fontsize=20)</span>
<span class="sd">    if save_files:</span>
<span class="sd">        if title is None:</span>
<span class="sd">            fname = &#39;equiv_diameter.png&#39;</span>
<span class="sd">        else:</span>
<span class="sd">            fname = f&#39;equiv_diameter_{title}.png&#39;</span>
<span class="sd">        plt.savefig(fname, bbox_inches=&quot;tight&quot;)</span>
<span class="sd">        print(f&quot;    &#39;{fname}&#39; is placed in the current working directory\n&quot;)</span>
<span class="sd">    plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># plot statistics of semi-axes</span>
    <span class="n">cts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xmin_gl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">xmax_gl</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nb</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]:</span>
        <span class="n">counts</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">cts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
        <span class="n">val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Semi-axis </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
        <span class="n">xmin_gl</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmin_gl</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="n">xmax_gl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmax_gl</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

    <span class="c1"># Plot the histogram &amp; PDF</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="c1"># Plot histogram</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ax[0].hist(val, weights=cts, density=False, bins=nb, label=label)</span>
<span class="sd">    ax[0].legend(loc=&quot;upper right&quot;, fontsize=12)</span>
<span class="sd">    ax[0].set_xlabel(&#39;length of semi-axis (m)&#39;, fontsize=14)</span>
<span class="sd">    ax[0].set_ylabel(&#39;frequency&#39;, fontsize=14)</span>
<span class="sd">    ax[0].tick_params(labelsize=12)&quot;&quot;&quot;</span>
    <span class="c1"># Plot PDF</span>
    <span class="n">xval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin_gl</span><span class="p">,</span> <span class="n">xmax_gl</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]):</span>
        <span class="n">ypdf</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span> <span class="n">sdict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_sig&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sdict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_scale&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span> <span class="n">ypdf</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Length of semi-axis (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="c1">#ax[1].set_title(title, fontsize=16)</span>
    <span class="k">if</span> <span class="n">save_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;semi_axes.png&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;semi_axes_</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    &#39;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&#39; is placed in the current working directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This work is published under a CC BY-SA 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>